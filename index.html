<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PlayerOK –ì–∞—Ä–∞–Ω—Ç</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #0F0F1E;
            color: #FFFFFF;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #0F0F1E;
        }

        /* Header with Liquid Glass Effect */
        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 32px 16px;
            margin-bottom: 0;
            position: relative;
            overflow: hidden;
        }

        /* Animated background blobs */
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(37, 99, 235, 0.15) 0%, transparent 70%);
            animation: blob1 15s ease-in-out infinite;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
            animation: blob2 20s ease-in-out infinite;
        }

        @keyframes blob1 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(20px, 30px) scale(1.1); }
        }

        @keyframes blob2 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(-30px, -20px) scale(0.9); }
        }

        /* Liquid Glass Logo Container */
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            position: relative;
            z-index: 1;
        }

        .logo-glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 16px 32px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        /* Glass shine effect */
        .logo-glass::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            animation: shine 3s ease-in-out infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .logo-text {
            font-size: 42px;
            font-weight: 900;
            display: flex;
            align-items: center;
            letter-spacing: -1px;
            position: relative;
            z-index: 1;
        }

        .logo-player {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 50%, #1D4ED8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
            filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.3));
        }

        .logo-ok {
            background: linear-gradient(135deg, #FFFFFF 0%, #E5E7EB 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.2));
        }

        .header h1 {
            font-size: 18px;
            color: #E5E7EB;
            margin-bottom: 4px;
            font-weight: 600;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        /* Screens */
        .screen {
            display: none;
            animation: fadeIn 0.3s ease-in;
            padding: 16px;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Welcome Screen */
        .welcome-content {
            text-align: center;
            padding: 20px 0;
        }

        .welcome-icon {
            font-size: 80px;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.5));
        }

        .welcome-title {
            font-size: 24px;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #3B82F6 0%, #60A5FA 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .welcome-text {
            color: #9CA3AF;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .steps {
            text-align: left;
            margin: 30px 0;
            padding: 24px;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .step:last-child {
            margin-bottom: 0;
        }

        .step-number {
            font-size: 24px;
            margin-right: 12px;
            min-width: 30px;
        }

        .step-text {
            color: #D1D5DB;
            line-height: 1.5;
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
            color: white;
            box-shadow: 
                0 4px 20px rgba(59, 130, 246, 0.4),
                0 0 40px rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-primary:active {
            transform: scale(0.98);
            box-shadow: 
                0 2px 12px rgba(59, 130, 246, 0.4),
                0 0 20px rgba(59, 130, 246, 0.2);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            color: #E5E7EB;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-secondary:active {
            background: rgba(255, 255, 255, 0.08);
        }

        .btn-small {
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #60A5FA;
        }

        /* Currency Selection */
        .currency-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        .currency-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .currency-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .currency-card:active::before {
            opacity: 1;
        }

        .currency-card:active {
            transform: scale(0.95);
            background: rgba(59, 130, 246, 0.15);
            border-color: #3B82F6;
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
        }

        .currency-icon {
            font-size: 40px;
            margin-bottom: 8px;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
        }

        .currency-name {
            font-size: 18px;
            font-weight: 600;
            color: #E5E7EB;
        }

        /* Input Fields */
        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            color: #D1D5DB;
            font-size: 14px;
            font-weight: 600;
        }

        .input-field {
            width: 100%;
            padding: 14px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #FFFFFF;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #3B82F6;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        .input-field::placeholder {
            color: #6B7280;
        }

        textarea.input-field {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        /* Deal Card */
        .deal-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .deal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        }

        .deal-id {
            font-size: 14px;
            color: #9CA3AF;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .deal-info {
            margin-bottom: 12px;
        }

        .deal-label {
            color: #9CA3AF;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .deal-value {
            font-size: 18px;
            font-weight: 600;
            color: #E5E7EB;
        }

        .deal-amount {
            font-size: 36px;
            font-weight: 700;
            background: linear-gradient(135deg, #3B82F6 0%, #60A5FA 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 16px 0;
            filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.5));
        }

        /* Share Link Box */
        .share-box {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px dashed rgba(59, 130, 246, 0.5);
            border-radius: 12px;
            padding: 16px;
            margin: 20px 0;
        }

        .share-link {
            word-break: break-all;
            color: #60A5FA;
            font-size: 14px;
            margin-bottom: 12px;
            display: block;
        }

        /* Requisites List */
        .requisites-list {
            margin-top: 20px;
        }

        .requisite-item {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-left: 4px solid transparent;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .requisite-item.active {
            border-left-color: #10B981;
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
        }

        .requisite-item.inactive {
            border-left-color: #EF4444;
        }

        .requisite-info {
            flex: 1;
        }

        .requisite-currency {
            font-weight: 600;
            margin-bottom: 4px;
            color: #E5E7EB;
        }

        .requisite-value {
            color: #9CA3AF;
            font-size: 14px;
            font-family: monospace;
        }

        .requisite-status {
            font-size: 20px;
        }

        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .status-waiting {
            background: rgba(251, 191, 36, 0.2);
            color: #FCD34D;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .status-paid {
            background: rgba(16, 185, 129, 0.2);
            color: #34D399;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-completed {
            background: rgba(59, 130, 246, 0.2);
            color: #60A5FA;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        /* Deal List Item */
        .deal-list-item {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .deal-list-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3B82F6, #60A5FA);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .deal-list-item:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.08);
        }

        .deal-list-item:active::before {
            opacity: 1;
        }

        .deal-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .deal-list-id {
            font-size: 14px;
            color: #9CA3AF;
            font-weight: 600;
        }

        .deal-list-amount {
            font-size: 20px;
            font-weight: 700;
            color: #60A5FA;
        }

        .deal-list-description {
            color: #D1D5DB;
            margin-bottom: 12px;
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .deal-list-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .deal-list-role {
            font-size: 12px;
            color: #9CA3AF;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            font-size: 80px;
            opacity: 0.2;
            margin-bottom: 16px;
        }

        /* Loading Spinner */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #3B82F6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Alert */
        .alert {
            padding: 16px;
            border-radius: 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid;
        }

        .alert-warning {
            background: rgba(251, 191, 36, 0.15);
            border-color: rgba(251, 191, 36, 0.3);
            color: #FCD34D;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.15);
            border-color: rgba(16, 185, 129, 0.3);
            color: #34D399;
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(239, 68, 68, 0.3);
            color: #F87171;
        }

        /* Back Button */
        .back-btn {
            position: fixed;
            top: 16px;
            left: 16px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            font-size: 20px;
            color: #E5E7EB;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .back-btn:active {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Footer Links */
        .footer-links {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .footer-link {
            color: #60A5FA;
            text-decoration: none;
            margin: 0 12px;
            font-size: 14px;
            font-weight: 600;
        }

        h2 {
            color: #E5E7EB;
            font-weight: 700;
        }

        .screen h2 {
            color: #E5E7EB;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.7);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-glass">
                    <div class="logo-text">
                        <span class="logo-player">Player</span><span class="logo-ok">ok</span>
                    </div>
                </div>
            </div>
            <h1>–ì–∞—Ä–∞–Ω—Ç —Å–µ—Ä–≤–∏—Å</h1>
            <p>–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–¥–µ–ª–∫–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞</p>
        </div>

        <div id="mainScreen" class="screen active">
            <div class="welcome-content">
                <div class="welcome-icon">üõ°Ô∏è</div>
                <h2 class="welcome-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
                <p class="welcome-text">
                    –ú—ã –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–∞—à–∏—Ö —Å–¥–µ–ª–æ–∫ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ PlayerOK.
                </p>
                
                <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ AncTeam (–±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω) -->
                <div id="ancteamBadge" style="display: none; margin: 16px 0; padding: 12px 16px; background: rgba(16, 185, 129, 0.15); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px;">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span style="font-size: 18px;">‚úÖ</span>
                        <span style="color: #34D399; font-weight: 600; font-size: 14px;">–†–µ–∂–∏–º –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –∞–∫—Ç–∏–≤–µ–Ω</span>
                    </div>
                </div>

                <div class="steps">
                    <div class="step">
                        <div class="step-number">1Ô∏è‚É£</div>
                        <div class="step-text">–ü—Ä–æ–¥–∞–≤–µ—Ü —Å–æ–∑–¥–∞–µ—Ç —Å–¥–µ–ª–∫—É</div>
                    </div>
                    <div class="step">
                        <div class="step-number">2Ô∏è‚É£</div>
                        <div class="step-text">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç —á–µ—Ä–µ–∑ –±–æ—Ç–∞</div>
                    </div>
                    <div class="step">
                        <div class="step-number">3Ô∏è‚É£</div>
                        <div class="step-text">–ü—Ä–æ–¥–∞–≤–µ—Ü –ø–µ—Ä–µ–¥–∞–µ—Ç —Ç–æ–≤–∞—Ä –º–µ–Ω–µ–¥–∂–µ—Ä—É</div>
                    </div>
                    <div class="step">
                        <div class="step-number">4Ô∏è‚É£</div>
                        <div class="step-text">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π –∑–∞–∫–∞–∑</div>
                    </div>
                    <div class="step">
                        <div class="step-number">5Ô∏è‚É£</div>
                        <div class="step-text">–ü—Ä–æ–¥–∞–≤–µ—Ü –ø–æ–ª—É—á–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ —Å–≤–æ–∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</div>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" onclick="checkRequisitesAndCreateDeal()">
                üíº –°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É
            </button>
            <button class="btn btn-secondary" onclick="showMyDeals()">
                üìã –ú–æ–∏ —Å–¥–µ–ª–∫–∏
            </button>
            <button class="btn btn-secondary" onclick="showScreen('requisitesScreen')">
                üí≥ –ú–æ–∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
            </button>

            <div class="footer-links">
                <a href="https://t.me/PlayerOKTransfer" class="footer-link">üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
                <a href="https://playerok.com" class="footer-link">üåê –°–∞–π—Ç</a>
            </div>
        </div>

        <div id="requisitesScreen" class="screen">
            <button class="back-btn" onclick="showScreen('mainScreen')">‚Üê</button>
            
            <h2 style="margin-bottom: 20px; font-size: 24px;">üí≥ –ú–æ–∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</h2>

            <div class="requisites-list" id="requisitesList"></div>

            <button class="btn btn-primary" onclick="showScreen('addRequisiteScreen')">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
            </button>
        </div>

        <div id="addRequisiteScreen" class="screen">
            <button class="back-btn" onclick="showScreen('requisitesScreen')">‚Üê</button>
            
            <h2 style="margin-bottom: 20px; font-size: 24px;">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É</h2>

            <div class="currency-grid">
                <div class="currency-card" onclick="selectRequisiteCurrency('TON')">
                    <div class="currency-icon">üíé</div>
                    <div class="currency-name">TON</div>
                </div>
                <div class="currency-card" onclick="selectRequisiteCurrency('USDT')">
                    <div class="currency-icon">üíµ</div>
                    <div class="currency-name">USDT</div>
                </div>
                <div class="currency-card" onclick="selectRequisiteCurrency('RUB')">
                    <div class="currency-icon">‚ÇΩ</div>
                    <div class="currency-name">RUB</div>
                </div>
                <div class="currency-card" onclick="selectRequisiteCurrency('STARS')">
                    <div class="currency-icon">‚≠ê</div>
                    <div class="currency-name">STARS</div>
                </div>
            </div>
        </div>

        <div id="myDealsScreen" class="screen">
            <button class="back-btn" onclick="showScreen('mainScreen')">‚Üê</button>
            
            <h2 style="margin-bottom: 20px; font-size: 24px;">üìã –ú–æ–∏ —Å–¥–µ–ª–∫–∏</h2>

            <div id="dealsListContainer"></div>

            <div id="noDealsMessage" style="text-align: center; padding: 40px 20px; display: none;">
                <div style="font-size: 64px; margin-bottom: 16px; opacity: 0.3;">üìã</div>
                <p style="color: #9CA3AF; font-size: 16px;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–¥–µ–ª–æ–∫</p>
                <button class="btn btn-primary" onclick="showScreen('mainScreen')" style="margin-top: 20px; max-width: 200px;">
                    –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é —Å–¥–µ–ª–∫—É
                </button>
            </div>
        </div>

        <div id="dealDetailScreen" class="screen">
            <button class="back-btn" onclick="showMyDeals()">‚Üê</button>
            
            <h2 style="margin-bottom: 20px; font-size: 24px;">üíº –î–µ—Ç–∞–ª–∏ —Å–¥–µ–ª–∫–∏</h2>

            <div class="deal-card" id="dealDetailCard"></div>

            <div id="dealDetailActions"></div>
        </div>

        <div id="enterRequisiteScreen" class="screen">
            <button class="back-btn" onclick="showScreen('addRequisiteScreen')">‚Üê</button>
            
            <h2 style="margin-bottom: 20px; font-size: 24px;" id="requisiteTitle">–í–≤–µ–¥–∏—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</h2>

            <div class="input-group">
                <label class="input-label" id="requisiteLabel">–†–µ–∫–≤–∏–∑–∏—Ç—ã:</label>
                <input type="text" class="input-field" id="requisiteInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ">
            </div>

            <button class="btn btn-primary" onclick="saveRequisite()">
                ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            </button>
        </div>

        <div id="currencyScreen" class="screen">
            <button class="back-btn" onclick="showScreen('mainScreen')">‚Üê</button>
            
            <h2 style="margin-bottom: 20px; font-size: 24px;">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É —Å–¥–µ–ª–∫–∏</h2>

            <div class="currency-grid">
                <div class="currency-card" onclick="selectCurrency('TON')">
                    <div class="currency-icon">üíé</div>
                    <div class="currency-name">TON</div>
                </div>
                <div class="currency-card" onclick="selectCurrency('USDT')">
                    <div class="currency-icon">üíµ</div>
                    <div class="currency-name">USDT</div>
                </div>
                <div class="currency-card" onclick="selectCurrency('RUB')">
                    <div class="currency-icon">‚ÇΩ</div>
                    <div class="currency-name">RUB</div>
                </div>
                <div class="currency-card" onclick="selectCurrency('STARS')">
                    <div class="currency-icon">‚≠ê</div>
                    <div class="currency-name">STARS</div>
                </div>
            </div>
        </div>

        <div id="dealDetailsScreen" class="screen">
            <button class="back-btn" onclick="showScreen('currencyScreen')">‚Üê</button>
            
            <h2 style="margin-bottom: 20px; font-size: 24px;">
                <span id="selectedCurrencyIcon"></span> –î–µ—Ç–∞–ª–∏ —Å–¥–µ–ª–∫–∏
            </h2>

            <div class="input-group">
                <label class="input-label">–û–ø–∏—Å–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏:</label>
                <textarea class="input-field" id="dealDescription" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–¥–∞—Ä–æ–∫ 10000 –∑–≤–µ–∑–¥ Telegram"></textarea>
            </div>

            <div class="input-group">
                <label class="input-label">–°—É–º–º–∞:</label>
                <input type="number" class="input-field" id="dealAmount" placeholder="1000" min="0" step="0.01">
            </div>

            <button class="btn btn-primary" onclick="createDeal()">
                ‚úÖ –°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É
            </button>
        </div>

        <div id="dealCreatedScreen" class="screen">
            <button class="back-btn" onclick="showScreen('mainScreen')">‚Üê</button>
            
            <div class="alert alert-success">
                <span style="font-size: 24px;">‚úÖ</span>
                <span>–°–¥–µ–ª–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!</span>
            </div>

            <div class="deal-card" id="createdDealCard"></div>

            <div class="share-box">
                <div style="color: #9CA3AF; margin-bottom: 8px; font-size: 14px;">
                    üîó –û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –ø–æ–∫—É–ø–∞—Ç–µ–ª—é:
                </div>
                <div class="share-link" id="dealLink"></div>
                <button class="btn btn-small" onclick="copyDealLink()">
                    üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                </button>
            </div>

            <button class="btn btn-secondary" onclick="showScreen('mainScreen')">
                üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é
            </button>
        </div>

        <div id="viewDealScreen" class="screen">
            <h2 style="margin-bottom: 20px; font-size: 24px;">üíº –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–¥–µ–ª–∫–µ</h2>

            <div class="deal-card" id="viewDealCard"></div>
            
            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏) -->
            <div id="dealWarningContainer"></div>

            <button class="btn btn-primary" id="payDealBtn" onclick="payDeal()">
                üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —Å–¥–µ–ª–∫—É
            </button>
        </div>

        <div id="paymentSuccessScreen" class="screen">
            <div class="welcome-content">
                <div class="welcome-icon">‚úÖ</div>
                <h2 class="welcome-title">–°–¥–µ–ª–∫–∞ –æ–ø–ª–∞—á–µ–Ω–∞!</h2>
                <p class="welcome-text">
                    –û–∂–∏–¥–∞–π—Ç–µ –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–¥–∞–≤—Ü–æ–º.
                </p>

                <div class="deal-card" id="paidDealCard"></div>

                <div class="status-badge status-paid">
                    üí∞ –û–ø–ª–∞—á–µ–Ω–æ
                </div>
            </div>
        </div>

        <div id="transferScreen" class="screen">
            <h2 style="margin-bottom: 20px; font-size: 24px;">üì¶ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏</h2>

            <div class="alert alert-success">
                <span style="font-size: 24px;">üîî</span>
                <span>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å –æ–ø–ª–∞—Ç–∏–ª —Å–¥–µ–ª–∫—É!</span>
            </div>

            <div class="deal-card" id="transferDealCard"></div>

            <div style="background: rgba(251, 191, 36, 0.15); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 12px; padding: 16px; margin: 20px 0;">
                <p style="color: #FCD34D; margin-bottom: 8px;">
                    üì¶ –ü–µ—Ä–µ–¥–∞–π—Ç–µ –ø–æ–¥–∞—Ä–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä—É:
                </p>
                <a href="https://t.me/PlayerOKTransfer" style="color: #60A5FA; text-decoration: none; font-weight: 600;">
                    @PlayerOKTransfer
                </a>
            </div>

            <button class="btn btn-primary" onclick="confirmTransfer()">
                ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É
            </button>
        </div>

        <div id="checkingScreen" class="screen">
            <div class="loading">
                <div class="spinner"></div>
                <h2 style="margin-bottom: 12px;">üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏...</h2>
                <p style="color: #9CA3AF;">–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ 30 —Å–µ–∫—É–Ω–¥</p>
            </div>
        </div>

        <div id="transferFailedScreen" class="screen">
            <div class="alert alert-error">
                <span style="font-size: 24px;">‚ùå</span>
                <span>–ü–æ–¥–∞—Ä–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!</span>
            </div>

            <p style="color: #9CA3AF; margin: 20px 0; line-height: 1.6;">
                –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –ø–æ–¥–∞—Ä–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä—É 
                <a href="https://t.me/PlayerOKTransfer" style="color: #60A5FA;">@PlayerOKTransfer</a>
                –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.
            </p>

            <button class="btn btn-primary" onclick="showScreen('transferScreen')">
                üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
            </button>
        </div>
    </div>

    <script>
        // Telegram WebApp initialization
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        let botUsername = 'PlayerokGITBot'; 
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('bot')) {
            botUsername = urlParams.get('bot');
        }
        
        if (tg.initDataUnsafe?.bot_username) {
            botUsername = tg.initDataUnsafe.bot_username;
        }

        let userData = {
            userId: tg.initDataUnsafe?.user?.id || 'demo_user',
            username: tg.initDataUnsafe?.user?.username || 'DemoUser',
            firstName: tg.initDataUnsafe?.user?.first_name || 'Demo',
            requisites: {},
            ancTeam: false
        };

        let currentDeal = {};
        let dealCounter = 1000;
        let deals = {};

        const currencyIcons = {
            'TON': 'üíé',
            'USDT': 'üíµ',
            'RUB': '‚ÇΩ',
            'STARS': '‚≠ê'
        };

        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è Base64 ---
        function encodeDealToBase64(deal) {
            // –°–æ–∫—Ä–∞—â–∞–µ–º –∫–ª—é—á–∏ –¥–ª—è –µ—â–µ –±–æ–ª—å—à–µ–π —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
            const mini = {
                i: deal.id,
                s: deal.sellerId,
                u: deal.sellerUsername,
                c: deal.currency,
                d: deal.description,
                a: deal.amount,
                t: deal.createdAt
            };
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º btoa —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Unicode
            return btoa(unescape(encodeURIComponent(JSON.stringify(mini))))
                .replace(/\+/g, '-')
                .replace(/\//g, '_')
                .replace(/=+$/, '');
        }

        function decodeDealFromBase64(base64) {
            try {
                const str = decodeURIComponent(escape(atob(base64.replace(/-/g, '+').replace(/_/g, '/'))));
                const data = JSON.parse(str);
                return {
                    id: data.i,
                    sellerId: data.s,
                    sellerUsername: data.u,
                    currency: data.c,
                    description: data.d,
                    amount: data.a,
                    createdAt: data.t,
                    status: 'waiting_buyer'
                };
            } catch (e) {
                console.error('Decode error:', e);
                return null;
            }
        }

        function init() {
            loadUserData();
            updateRequisitesList();
            updateAncteamUI(); // –û–±–Ω–æ–≤–ª—è–µ–º UI —Å—Ç–∞—Ç—É—Å–∞ AncTeam
            
            const startParam = tg.initDataUnsafe?.start_param;
            if (startParam) {
                // –ü—ã—Ç–∞–µ–º—Å—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∏–∑ Base64
                const deal = decodeDealFromBase64(startParam);
                if (deal) {
                    const savedDeals = localStorage.getItem('playerok_deals_global');
                    deals = savedDeals ? JSON.parse(savedDeals) : {};
                    deals[deal.id] = deal;
                    localStorage.setItem('playerok_deals_global', JSON.stringify(deals));
                    loadDeal(deal.id);
                } else if (startParam.startsWith('deal_')) {
                    // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º
                    const parts = startParam.split('_');
                    if (parts.length >= 2) {
                        loadDeal(parseInt(parts[1]));
                    }
                }
            }
        }
        
        function updateAncteamUI() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –±–µ–π–¥–∂ AncTeam –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
            const badge = document.getElementById('ancteamBadge');
            if (badge) {
                if (userData.ancTeam) {
                    badge.style.display = 'block';
                    console.log('üíö –ü–æ–∫–∞–∑–∞–Ω –±–µ–π–¥–∂ AncTeam');
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        function loadUserData() {
            const saved = localStorage.getItem('playerok_user_' + userData.userId);
            if (saved) {
                const data = JSON.parse(saved);
                userData.requisites = data.requisites || {};
                userData.ancTeam = data.ancTeam || false;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä ancteam –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
            let ancteamDetected = false;
            
            // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º URL query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            try {
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.has('ancteam') && urlParams.get('ancteam') === '1') {
                    ancteamDetected = true;
                    console.log('‚úÖ AncTeam –Ω–∞–π–¥–µ–Ω –≤ URL query');
                }
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ URL params:', e);
            }
            
            // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º hash –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            try {
                if (window.location.hash.includes('ancteam=1')) {
                    ancteamDetected = true;
                    console.log('‚úÖ AncTeam –Ω–∞–π–¥–µ–Ω –≤ hash');
                }
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ URLSearchParams –≤ hash
                const hashParams = new URLSearchParams(window.location.hash.replace('#', '?'));
                if (hashParams.has('ancteam') && hashParams.get('ancteam') === '1') {
                    ancteamDetected = true;
                    console.log('‚úÖ AncTeam –Ω–∞–π–¥–µ–Ω –≤ hash params');
                }
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ hash:', e);
            }
            
            // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª–Ω—ã–π URL (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –≥–¥–µ-—Ç–æ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ)
            try {
                const fullUrl = window.location.href;
                if (fullUrl.includes('ancteam=1')) {
                    ancteamDetected = true;
                    console.log('‚úÖ AncTeam –Ω–∞–π–¥–µ–Ω –≤ –ø–æ–ª–Ω–æ–º URL');
                }
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª–Ω–æ–≥–æ URL:', e);
            }
            
            // 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ Telegram WebApp (tgWebAppStartParam)
            try {
                if (window.Telegram?.WebApp?.initDataUnsafe?.start_param) {
                    const startParam = window.Telegram.WebApp.initDataUnsafe.start_param;
                    if (startParam.includes('ancteam')) {
                        ancteamDetected = true;
                        console.log('‚úÖ AncTeam –Ω–∞–π–¥–µ–Ω –≤ start_param');
                    }
                }
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ start_param:', e);
            }
            
            // –ï—Å–ª–∏ ancteam –æ–±–Ω–∞—Ä—É–∂–µ–Ω - –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
            if (ancteamDetected && !userData.ancTeam) {
                userData.ancTeam = true;
                saveUserData();
                console.log('üéâ AncTeam —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', userData.userId);
            }
            
            // –í—ã–≤–æ–¥–∏–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            console.log('üë§ User ID:', userData.userId);
            console.log('‚úÖ AncTeam Status:', userData.ancTeam);
            console.log('üîó Current URL:', window.location.href);
        }

        function saveUserData() {
            localStorage.setItem('playerok_user_' + userData.userId, JSON.stringify({
                requisites: userData.requisites,
                ancTeam: userData.ancTeam
            }));
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');

            if (screenId === 'mainScreen') {
                tg.BackButton.hide();
            } else {
                tg.BackButton.show();
                tg.BackButton.onClick(() => {
                    if (screenId === 'requisitesScreen' || screenId === 'currencyScreen') {
                        showScreen('mainScreen');
                    } else if (screenId === 'addRequisiteScreen') {
                        showScreen('requisitesScreen');
                    } else if (screenId === 'enterRequisiteScreen') {
                        showScreen('addRequisiteScreen');
                    } else if (screenId === 'dealDetailsScreen') {
                        showScreen('currencyScreen');
                    } else if (screenId === 'dealCreatedScreen') {
                        showScreen('mainScreen');
                    } else {
                        showScreen('mainScreen');
                    }
                });
            }
        }

        function updateRequisitesList() {
            const list = document.getElementById('requisitesList');
            const currencies = ['TON', 'USDT', 'RUB', 'STARS'];
            let html = '';
            currencies.forEach(currency => {
                const value = userData.requisites[currency];
                const hasValue = value && value.trim() !== '';
                html += `
                    <div class="requisite-item ${hasValue ? 'active' : 'inactive'}">
                        <div class="requisite-info">
                            <div class="requisite-currency">${currencyIcons[currency]} ${currency}</div>
                            <div class="requisite-value">${hasValue ? value : '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</div>
                        </div>
                        <div class="requisite-status">${hasValue ? '‚úÖ' : '‚ùå'}</div>
                    </div>
                `;
            });
            list.innerHTML = html;
        }

        function selectRequisiteCurrency(currency) {
            currentDeal.requisiteCurrency = currency;
            const titles = { 'TON': 'üíé TON –∞–¥—Ä–µ—Å', 'USDT': 'üíµ USDT –∞–¥—Ä–µ—Å (TRC20)', 'RUB': '‚ÇΩ –ù–æ–º–µ—Ä –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç—ã', 'STARS': '‚≠ê STARS —Ä–µ–∫–≤–∏–∑–∏—Ç—ã' };
            const placeholders = { 'TON': 'UQAbc...xyz', 'USDT': 'TRXabc...xyz', 'RUB': '1234 5678 9012 3456', 'STARS': '–í–≤–µ–¥–∏—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã' };
            document.getElementById('requisiteTitle').innerHTML = titles[currency];
            document.getElementById('requisiteLabel').textContent = `${currency} —Ä–µ–∫–≤–∏–∑–∏—Ç—ã:`;
            document.getElementById('requisiteInput').placeholder = placeholders[currency];
            document.getElementById('requisiteInput').value = userData.requisites[currency] || '';
            showScreen('enterRequisiteScreen');
        }

        function saveRequisite() {
            const currency = currentDeal.requisiteCurrency;
            const value = document.getElementById('requisiteInput').value.trim();
            if (!value) { tg.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã'); return; }
            userData.requisites[currency] = value;
            saveUserData();
            updateRequisitesList();
            tg.showPopup({ title: '‚úÖ –£—Å–ø–µ—à–Ω–æ', message: `–†–µ–∫–≤–∏–∑–∏—Ç—ã ${currency} —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!`, buttons: [{type: 'ok'}] });
            showScreen('requisitesScreen');
        }

        function checkRequisitesAndCreateDeal() {
            const hasAnyRequisite = Object.values(userData.requisites).some(v => v && v.trim() !== '');
            if (!hasAnyRequisite) {
                tg.showPopup({
                    title: '‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º—ã —Ä–µ–∫–≤–∏–∑–∏—Ç—ã',
                    message: '–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏ —Å–Ω–∞—á–∞–ª–∞ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã.',
                    buttons: [{id: 'add', type: 'default', text: '–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã'}, {type: 'cancel'}]
                }, (buttonId) => { if (buttonId === 'add') showScreen('requisitesScreen'); });
                return;
            }
            showScreen('currencyScreen');
        }

        function selectCurrency(currency) {
            currentDeal.currency = currency;
            document.getElementById('selectedCurrencyIcon').textContent = currencyIcons[currency];
            showScreen('dealDetailsScreen');
        }

        function createDeal() {
            const description = document.getElementById('dealDescription').value.trim();
            const amount = parseFloat(document.getElementById('dealAmount').value);
            if (!description || !amount || amount <= 0) {
                tg.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                return;
            }
            
            const savedDeals = localStorage.getItem('playerok_deals_global');
            if (savedDeals) {
                deals = JSON.parse(savedDeals);
                const ids = Object.keys(deals).map(id => parseInt(id)).filter(id => !isNaN(id));
                if (ids.length > 0) dealCounter = Math.max(...ids, 1000);
            }
            
            dealCounter++;
            const deal = {
                id: dealCounter,
                sellerId: userData.userId,
                sellerUsername: userData.username,
                currency: currentDeal.currency,
                description: description,
                amount: amount,
                status: 'waiting_buyer',
                createdAt: new Date().toISOString()
            };
            
            deals[deal.id] = deal;
            localStorage.setItem('playerok_deals_global', JSON.stringify(deals));
            displayCreatedDeal(deal);
            showScreen('dealCreatedScreen');
        }

        function displayCreatedDeal(deal) {
            const card = document.getElementById('createdDealCard');
            card.innerHTML = `
                <div class="deal-id">–°–¥–µ–ª–∫–∞ #${deal.id}</div>
                <div class="deal-info"><div class="deal-label">–û–ø–∏—Å–∞–Ω–∏–µ:</div><div class="deal-value">${deal.description}</div></div>
                <div class="deal-amount">${currencyIcons[deal.currency]} ${deal.amount} ${deal.currency}</div>
            `;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ—Ä–æ—Ç–∫—É—é Base64 —Å—Å—ã–ª–∫—É
            const b64 = encodeDealToBase64(deal);
            const dealLink = `https://t.me/${botUsername}?startapp=${b64}`;
            document.getElementById('dealLink').textContent = dealLink;
            currentDeal.link = dealLink;
        }

        function copyDealLink() {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(currentDeal.link).then(() => {
                    tg.showPopup({ title: '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ', message: '–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!', buttons: [{type: 'ok'}] });
                });
            } else { tg.showAlert('–°—Å—ã–ª–∫–∞: ' + currentDeal.link); }
        }

        function loadDeal(dealId) {
            const savedDeals = localStorage.getItem('playerok_deals_global');
            if (savedDeals) deals = JSON.parse(savedDeals);
            const deal = deals[dealId];
            if (!deal) { tg.showAlert('–°–¥–µ–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'); return; }
            if (deal.sellerId === userData.userId) { showScreen('mainScreen'); return; }
            currentDeal = deal;
            displayDealForBuyer(deal);
            showScreen('viewDealScreen');
        }

        function displayDealForBuyer(deal) {
            const card = document.getElementById('viewDealCard');
            card.innerHTML = `
                <div class="deal-id">–°–¥–µ–ª–∫–∞ #${deal.id}</div>
                <div class="deal-info"><div class="deal-label">–ü—Ä–æ–¥–∞–≤–µ—Ü:</div><div class="deal-value">@${deal.sellerUsername}</div></div>
                <div class="deal-info"><div class="deal-label">–û–ø–∏—Å–∞–Ω–∏–µ:</div><div class="deal-value">${deal.description}</div></div>
                <div class="deal-amount">${currencyIcons[deal.currency]} ${deal.amount} ${deal.currency}</div>
            `;
            
            const payBtn = document.getElementById('payDealBtn');
            const warningContainer = document.getElementById('dealWarningContainer');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å ancteam
            console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞: userData.ancTeam =', userData.ancTeam);
            
            if (!userData.ancTeam) {
                // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –æ–ø–ª–∞—Ç—ã
                payBtn.style.opacity = '0.5';
                payBtn.style.pointerEvents = 'none';
                payBtn.disabled = true;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                warningContainer.innerHTML = `
                    <div style="margin: 16px 0; padding: 16px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px;">
                        <div style="display: flex; align-items: flex-start; gap: 12px;">
                            <div style="font-size: 24px; flex-shrink: 0;">üîí</div>
                            <div>
                                <div style="font-weight: 600; color: #FCA5A5; margin-bottom: 8px; font-size: 15px;">
                                    –û–ø–ª–∞—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
                                </div>
                                <div style="font-size: 13px; color: rgba(255, 255, 255, 0.8); line-height: 1.6;">
                                    –î–ª—è –æ–ø–ª–∞—Ç—ã —Å–¥–µ–ª–æ–∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∂–∏–º –ø–æ–∫—É–ø–∞—Ç–µ–ª—è. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞.
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                console.log('‚ùå –ö–Ω–æ–ø–∫–∞ –æ–ø–ª–∞—Ç—ã –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ - –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ AncTeam');
            } else {
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –æ–ø–ª–∞—Ç—ã
                payBtn.style.opacity = '1';
                payBtn.style.pointerEvents = 'auto';
                payBtn.disabled = false;
                
                // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
                warningContainer.innerHTML = '';
                
                console.log('‚úÖ –ö–Ω–æ–ø–∫–∞ –æ–ø–ª–∞—Ç—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ - –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø AncTeam');
            }
        }

        function payDeal() {
            tg.showPopup({
                title: 'üí≥ –û–ø–ª–∞—Ç–∞',
                message: `–û–ø–ª–∞—Ç–∏—Ç—å ${currentDeal.amount} ${currentDeal.currency}?`,
                buttons: [{id: 'confirm', type: 'default', text: '–û–ø–ª–∞—Ç–∏—Ç—å'}, {type: 'cancel'}]
            }, (id) => { if (id === 'confirm') processPay(); });
        }

        function processPay() {
            currentDeal.status = 'paid';
            currentDeal.buyerId = userData.userId;
            currentDeal.buyerUsername = userData.username;
            currentDeal.paidAt = new Date().toISOString();
            deals[currentDeal.id] = currentDeal;
            localStorage.setItem('playerok_deals_global', JSON.stringify(deals));
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –±–æ—Ç—É –æ —Ç–æ–º, —á—Ç–æ —Å–¥–µ–ª–∫–∞ –æ–ø–ª–∞—á–µ–Ω–∞
            try {
                const paymentData = {
                    action: 'deal_paid',
                    deal_id: currentDeal.id,
                    deal_info: {
                        seller_id: currentDeal.sellerId,
                        seller_username: currentDeal.sellerUsername,
                        buyer_id: userData.userId,
                        buyer_username: userData.username,
                        currency: currentDeal.currency,
                        amount: currentDeal.amount,
                        description: currentDeal.description
                    }
                };
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Telegram WebApp API
                tg.sendData(JSON.stringify(paymentData));
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ–± –æ–ø–ª–∞—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É');
            } catch (e) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
            }
            
            const card = document.getElementById('paidDealCard');
            card.innerHTML = `
                <div class="deal-id">–°–¥–µ–ª–∫–∞ #${currentDeal.id}</div>
                <div class="deal-amount">${currencyIcons[currentDeal.currency]} ${currentDeal.amount} ${currentDeal.currency}</div>
            `;
            showScreen('paymentSuccessScreen');
        }

        function confirmTransfer() {
            showScreen('checkingScreen');
            setTimeout(() => { showScreen('transferFailedScreen'); }, 30000);
        }

        function showMyDeals() {
            const savedDeals = localStorage.getItem('playerok_deals_global');
            if (savedDeals) deals = JSON.parse(savedDeals);
            const myDeals = Object.values(deals).filter(d => d.sellerId === userData.userId || d.buyerId === userData.userId);
            const container = document.getElementById('dealsListContainer');
            const noDealsMsg = document.getElementById('noDealsMessage');
            if (myDeals.length === 0) {
                container.innerHTML = '';
                noDealsMsg.style.display = 'block';
            } else {
                noDealsMsg.style.display = 'none';
                myDeals.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                let html = '';
                myDeals.forEach(deal => {
                    const isSeller = deal.sellerId === userData.userId;
                    html += `
                        <div class="deal-list-item" onclick="showDealDetail(${deal.id})">
                            <div class="deal-list-header">
                                <div class="deal-list-id">–°–¥–µ–ª–∫–∞ #${deal.id}</div>
                                <div class="deal-list-amount">${currencyIcons[deal.currency]} ${deal.amount}</div>
                            </div>
                            <div class="deal-list-description">${deal.description}</div>
                            <div class="deal-list-footer">
                                <div class="deal-list-role">üë§ ${isSeller ? '–ü—Ä–æ–¥–∞–≤–µ—Ü' : '–ü–æ–∫—É–ø–∞—Ç–µ–ª—å'}</div>
                                <div class="status-badge ${getStatusClass(deal.status)}">${getStatusText(deal.status)}</div>
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html;
            }
            showScreen('myDealsScreen');
        }

        function getStatusText(s) { 
            return { 'waiting_buyer': '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ', 'paid': 'üí∞ –û–ø–ª–∞—á–µ–Ω–æ', 'completed': '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ' }[s] || s; 
        }
        function getStatusClass(s) { 
            return { 'waiting_buyer': 'status-waiting', 'paid': 'status-paid', 'completed': 'status-completed' }[s] || 'status-waiting'; 
        }

        function showDealDetail(dealId) {
            const savedDeals = localStorage.getItem('playerok_deals_global');
            if (savedDeals) deals = JSON.parse(savedDeals);
            const deal = deals[dealId];
            if (!deal) return;
            const isSeller = deal.sellerId === userData.userId;
            const card = document.getElementById('dealDetailCard');
            card.innerHTML = `
                <div class="deal-id">–°–¥–µ–ª–∫–∞ #${deal.id}</div>
                <div style="margin-bottom: 16px;"><span class="status-badge ${getStatusClass(deal.status)}">${getStatusText(deal.status)}</span></div>
                <div class="deal-info"><div class="deal-label">–†–æ–ª—å:</div><div class="deal-value">${isSeller ? '–ü—Ä–æ–¥–∞–≤–µ—Ü' : '–ü–æ–∫—É–ø–∞—Ç–µ–ª—å'}</div></div>
                <div class="deal-info"><div class="deal-label">–û–ø–∏—Å–∞–Ω–∏–µ:</div><div class="deal-value">${deal.description}</div></div>
                <div class="deal-amount">${currencyIcons[deal.currency]} ${deal.amount}</div>
            `;
            const actions = document.getElementById('dealDetailActions');
            if (isSeller && deal.status === 'waiting_buyer') {
                const b64 = encodeDealToBase64(deal);
                const link = `https://t.me/${botUsername}?startapp=${b64}`;
                actions.innerHTML = `
                    <div class="share-box">
                        <div class="share-link">${link}</div>
                        <button class="btn btn-small" onclick="copyDealDetailLink('${link}')">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>`;
            } else if (isSeller && deal.status === 'paid') {
                actions.innerHTML = `<button class="btn btn-primary" onclick="confirmTransfer()">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É</button>`;
            } else { actions.innerHTML = ''; }
            showScreen('dealDetailScreen');
        }

        function copyDealDetailLink(l) {
            navigator.clipboard.writeText(l).then(() => { tg.showAlert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!'); });
        }

        init();
    </script>
</body>
</html>